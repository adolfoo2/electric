<!DOCTYPE html>
<html lang="en">
<head>

	<!--
		Basic
	-->
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" /> 
	<title>Electric - LatAm</title>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />

	<meta name="keywords" content="vcard, resposnive, resume, personal, card, cv, cards, portfolio" />
	<meta name="author" content="beshleyua" />
	
	<!--
		Load Fonts
	-->
	<link href="https://fonts.googleapis.com/css?family=Poppins:100,100i,200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Cormorant+Garamond:300,300i,400,400i,500,500i,600,600i,700,700i&amp;subset=cyrillic" rel="stylesheet">
	
	<!--
		Load CSS
	-->
	<link rel="stylesheet" href="css/basic.css" />
	<link rel="stylesheet" href="css/layout.css" />
	<link rel="stylesheet" href="css/blogs.css" />
	<link rel="stylesheet" href="css/line-awesome.css" />
	<link rel="stylesheet" href="css/magnific-popup.css" />
	<link rel="stylesheet" href="css/animate.css" />
	<link rel="stylesheet" href="css/simplebar.css" />
	<link rel="newest stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
	


	<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	
	<!-- theme colors -->
	<link rel="stylesheet" href="css/theme-colors/green.css" />
	<!--<link rel="stylesheet" href="css/theme-colors/blue.css" />-->
	<!--<link rel="stylesheet" href="css/theme-colors/red.css" />-->
	<!--<link rel="stylesheet" href="css/theme-colors/orange.css" />-->
	<!--<link rel="stylesheet" href="css/theme-colors/pink.css" />-->
	<!--<link rel="stylesheet" href="css/theme-colors/purple.css" />-->
	
	<!--[if lt IE 9]>
	<script src="http://css3-mediaqueries-js.googlecode.com/svn/trunk/css3-mediaqueries.js"></script>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	
	<!--
		Favicons
	-->

	<link rel="shortcut icon" href="images/favicons/favicon.ico">
</head>

<body>

	<div class="page">

		<!--
			Preloader
		-->
		<div class="preloader">
			<div class="centrize full-width">
				<div class="vertical-center">
					<div class="spinner">
						<div class="double-bounce1"></div>
						<div class="double-bounce2"></div>
					</div>
				</div>
			</div>
		</div>
		
		<!--
			Header
		-->
		<header class="header">

			<!-- logo -->
			<div class="logo">
				<a href="#"><span>P</span></a>
			</div>

			<!-- menu 
			<div class="top-menu">
				<ul>
					<li class="active">
						<a href="./index.html">
							<span class="icon la la-home"></span>
							<span class="link">Home</span>
						</a>
					</li>
					<li>
						<a href="./perfil.html">
							<span class="icon la la-user"></span>
							<span class="link">Perfil</span>
						</a>
					</li>
					<li>
						<a href="#resume-card">
							<span class="icon la la-gear"></span>
							<span class="link">Resume</span>
						</a>
					</li>
					<li>
						<a href="#works-card">
							<span class="icon la la-eye"></span>
							<span class="link">Portfolio</span>
						</a>
					</li>
					<li>
						<a href="#blog-card">
							<span class="icon la la-newspaper-o"></span>
							<span class="link">Blog</span>
						</a>
					</li>
					<li>
						<a href="#contacts-card">
							<span class="icon la la-envelope"></span>
							<span class="link">Contacts</span>
						</a>
					</li>
				</ul>
			</div>-->

			<!-- Started socials -->
			<div class="social">
				<a target="_blank" href="https://facebook.com/"><span class="icon la la-facebook"></span></a>
			</div>

			<!-- Mobile Menu -->
			<span class="menu-btn">
				<span class="m-line"></span>
			</span>

		</header>


<!--
			Container
		-->
		


			<!--
				Card - Started
			-->
			<div class="card-inner card-started active" id="home-card">

				<div class="row card-container">

					<!--
						Card Wrap
					-->
					<div class="card-wrap col col-m-12 col-t-12 col-d-12 col-d-lg-12" data-simplebar>
						
						<!-- About Image 
						<div class="card-image col col-m-12 col-t-12 col-d-4 col-d-lg-6" style="background-image: url(images/profile.jpg);"></div>
						-->
						<!--
							Inner Top
						-->
						
						<div class="content inner-top">
							<div class="row">
								
								<div class="col col-m-12 col-t-12 col-d-12 col-d-lg-12">
									<div class="title-bg">  </div>
									<div class="text">
										<p>
											<strong>Registro - Verificación de usuario</strong>
											<div class="row">
												<div class="col col-m-12 col-t-12 col-d-12 col-d-lg-6">
				
													<!-- form -->

													<div class="contact_form card-box">
														<form class="pt-3">


															<div class="col col-m-12 col-t-12 col-d-12 col-d-lg-6 " style="color:blanchedalmond">
																<!--<div class="col col-m-12 col-t-6 col-d-6 col-d-lg-6">
																	<div class="group-val">
																		<input type="text" name="name" placeholder="Full Name" />
																	</div>
																</div>-->
																<div class='col-md-12 mb-12'>
																	<label id="titulo" for='uploader'>Cargando...</label><br>
																	
																	<input type="file" id="fileButton" value="upload"/><br><br>
																	<progress id="uploader" value="0" max="100">0%</progress>
																</div>
															</div>
										
															<!--<div class="mt-3">																
																<button class="btn btn-block btn-primary btn-lg font-weight-medium auth-form-btn" type="button" onClick="iniciar(this.form)">Continuar<span class="icon"><i class="la la-arrow-right"></i></span></button>
															  </div>-->
														</form>
														<div class="alert-success">
															<p> </p>
														</div>
													</div>
				
												</div>
											</div>
										</p>
									</div>

									<div class="circle-bts">
										<!--<a href="#"><span></span></a>-->
										
									</div>
								</div>
							</div>
						</div>

					</div>
					
				</div>
			</div>
		
			</div>


			<!-- 
				Lines Grid
			-->
			

		</div>
	</div>
	
	<!--
		jQuery Scripts
	-->
	<script src="js/jquery.min.js"></script>
	<script src="js/jquery.validate.js"></script>
	<script src="js/jquery.magnific-popup.js"></script>
	<script src="js/imagesloaded.pkgd.js"></script>
	<script src="js/masonry.pkgd.js"></script>
	<script src="js/masonry-filter.js"></script>
	<script src="js/simplebar.js"></script>
	<script src="js/typed.js"></script>
	

	
	<!--
		Main Scripts
	-->
	<script src="js/scripts.js"></script>
	
	
</body>



</script> 
<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-storage.js"></script>
<script>
  // Initialize Firebase
  var config = {
	apiKey: "AIzaSyBdAIe1K0LqZ7Vwm0g1uK2G-dB_fd6ClPo",
	authDomain: "electric-latam.firebaseapp.com",
	databaseURL: "https://electric-latam.firebaseio.com",
	projectId: "electric-latam",
	storageBucket: "electric-latam.appspot.com",
  };
  
  firebase.initializeApp(config);

  // make auth and firestore references
  const auth = firebase.auth();
  const db = firebase.firestore();

var storageRef = firebase.storage().ref();

  var database = firebase.database();

</script>
					<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
					<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/css/select2.min.css" rel="stylesheet" />
					<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-beta.1/dist/js/select2.min.js"></script>
<script type="text/javascript">
  
  auth.onAuthStateChanged(user => {
    var user = firebase.auth().currentUser;
    if(user===null){
		window.location.href = 'index.html';
	}else{
		var docRef = db.collection("users").doc(user.uid);
      	docRef.get().then(function(doc) {
    		var faseregistro = doc.data().faseregistro;
			var tipo = doc.data().tipo;
			if(faseregistro==2){
				//se espera este aqui
				
				if(tipo=="estudiante"){
					var titulo =     "<label id='titulo' for='uploader'>Certificado de alumno regular</label><br>";
				}else if(tipo=="empresa"){
					var titulo =     "<label id='titulo' for='uploader'>DNI o Documento de identificación del representante</label><br>";
				}else{
					var titulo =     "<label id='titulo' for='uploader'>Certificado de estudios o título profesional</label><br>";
				}
				document.getElementById("titulo").innerHTML = titulo;
			}else if(faseregistro==3){
				//ya habia temrinado el registro
				window.location.href = 'perfil.html';
			}else if(faseregistro==1){
				if(tipo=="estudiante"){
					window.location.href = 'registro2e.html';
				}else if(tipo=="empresa"){
					window.location.href = 'registro2em.html';
				}else{
					window.location.href = 'registro2p.html';
				}
				
			}
	  	})
	}
})

var uploader = document.getElementById('uploader');
var fileButton = document.getElementById('fileButton');
fileButton.addEventListener('change', function(e){
	var user = firebase.auth().currentUser;
	var file = e.target.files[0];
	console.log(file);
	var storageRef = firebase.storage().ref('documentoregistro/'+user.uid);
	var task = storageRef.put(file);
	task.on('state_changed', function progress(snapshot) {
		var percentage = (snapshot.bytesTransferred/snapshot.totalBytes)*100;
    	uploader.value = percentage;
	}, function error(err) {


	},function complete() {
		//carga correcta
		var userID = user.uid;
		var userRef = db.collection('users').doc(userID);
		var setWithMerge = userRef.set({
			faseregistro:3
		}, { merge: true }).then(function(docRef) {
			alert('Documento cargado correctamente. Será redireccionado.');
			window.location.href = 'perfil.html';
		});


	});
});  

  
	  </script>
	
</html>



